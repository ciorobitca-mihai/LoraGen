<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign In Page </title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: { 600: '#2563eb', 700: '#1d4ed8' }
          }
        }
      }
    }

    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }

    function toggleDarkMode() {
      const html = document.documentElement;
      const sunIcon = document.getElementById('icon-sun');
      const moonIcon = document.getElementById('icon-moon');
      if (html.classList.contains('dark')) {
        html.classList.remove('dark');
        localStorage.theme = 'light';
        sunIcon.classList.remove('hidden');
        moonIcon.classList.add('hidden');
      } else {
        html.classList.add('dark');
        localStorage.theme = 'dark';
        sunIcon.classList.add('hidden');
        moonIcon.classList.remove('hidden');
      }
    }

    function showAlert(title, message, type = "error") {
      const alertDiv = document.querySelector("#alert");
      const alertTitle = alertDiv.querySelector("#alert-title");
      const alertMessage = alertDiv.querySelector("#alert-message");

      // Set title and message
      alertTitle.textContent = title;
      alertMessage.textContent = message;

      // Remove existing color classes
      alertDiv.classList.remove(
        "text-blue-800", "border-blue-300", "bg-blue-50",
        "text-green-800", "border-green-300", "bg-green-50",
        "text-red-800", "border-red-300", "bg-red-50",
        "dark:text-blue-400", "dark:border-blue-800", "dark:bg-gray-800",
        "dark:text-green-400", "dark:border-green-800", "dark:bg-gray-800",
        "dark:text-red-400", "dark:border-red-800", "dark:bg-gray-800"
      );

      // Add classes based on type
      if (type === "success") {
        alertDiv.classList.add(
          "text-green-800", "border-green-300", "bg-green-50",
          "dark:text-green-400", "dark:border-green-800", "dark:bg-gray-800"
        );
      } else if (type === "error") {
        alertDiv.classList.add(
          "text-red-800", "border-red-300", "bg-red-50",
          "dark:text-red-400", "dark:border-red-800", "dark:bg-gray-800"
        );
      } else if (type === "info") {
        alertDiv.classList.add(
          "text-blue-800", "border-blue-300", "bg-blue-50",
          "dark:text-blue-400", "dark:border-blue-800", "dark:bg-gray-800"
        );
      }

      // Show the alert
      alertDiv.classList.remove("hidden");
    }

    window.addEventListener('DOMContentLoaded', () => {
      const alertDiv = document.querySelector("#alert");
      const alertTitle = alertDiv.querySelector("#alert-title");
      const alertMessage = alertDiv.querySelector("#alert-message");
      const sunIcon = document.getElementById('icon-sun');
      const moonIcon = document.getElementById('icon-moon');

      if (document.documentElement.classList.contains('dark')) {
        sunIcon.classList.add('hidden');
        moonIcon.classList.remove('hidden');
      } else {
        sunIcon.classList.remove('hidden');
        moonIcon.classList.add('hidden');
      }
      lucide.createIcons();

      const loginForm = document.querySelector("form");

      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;

        if (!email || !password) {
          alert("Please enter both email and password.");
          return;
        }

        try {
          const response = await fetch("/auth/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ email, password })
          });

          const data = await response.json();

          if (response.ok) {
            showAlert("Success", "Login successful!", "success");
            setTimeout(() => {
              window.location.href = data.redirect;;
            }, 1000);
          } else {
            showAlert("Error", data.message, "error");
          }

        } catch (error) {
          console.error("Login error:", error);
          showAlert("Error", error, "error");
        }
      });
    });
  </script>
</head>

<body class="bg-gray-50 dark:bg-gray-900 min-h-screen flex items-center justify-center">

  <button onclick="toggleDarkMode()"
    class="absolute top-5 right-5 flex items-center justify-center w-10 h-10 rounded-xl bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:shadow-md transition"
    aria-label="Toggle dark mode">
    <i id="icon-sun" data-lucide="sun" class="w-5 h-5"></i>
    <i id="icon-moon" data-lucide="moon" class="w-5 h-5 hidden"></i>
  </button>

  <div class="flex flex-col md:flex-row max-w-6xl mx-auto p-4 md:p-8">
    <div class="w-full md:w-1/2 p-8 md:p-12 bg-white dark:bg-gray-800 shadow-lg rounded-lg">
      <a href="/" class="flex items-center mb-6 text-2xl font-semibold text-gray-900 dark:text-white">
        <img class="w-8 h-8 mr-2" src="https://flowbite.s3.amazonaws.com/blocks/marketing-ui/logo.svg" alt="logo">
        Lora GEN
      </a>

      <h1 class="text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl dark:text-white mb-6">
        Good to see you again!
      </h1>

      <p class="text-gray-500 dark:text-gray-400 mb-6">
        Create stunning images in just seconds.
      </p>

      <form id="login-form" class="space-y-4">
        <div id="alert" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative">
          <strong class="font-bold" id="alert-title"></strong>
          <span class="block sm:inline" id="alert-message"></span>
        </div>

        <div>
          <label for="email" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Email</label>
          <input type="email" id="email"
            class="w-full p-2.5 border border-gray-300 rounded-lg bg-gray-50 text-gray-900 focus:ring-primary-600 focus:border-primary-600 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
            placeholder="yourname@company.com" required>
        </div>

        <div>
          <label for="password" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Password</label>
          <input type="password" id="password"
            class="w-full p-2.5 border border-gray-300 rounded-lg bg-gray-50 text-gray-900 focus:ring-primary-600 focus:border-primary-600 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
            placeholder="••••••••" required>
        </div>

        <button type="submit"
          class="w-full bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-primary-600 dark:hover:bg-primary-700">
          Sign In
        </button>

        <div class="flex items-center my-4">
          <hr class="flex-grow border-gray-300 dark:border-gray-600">
          <span class="mx-2 text-gray-500 dark:text-gray-400 text-sm">or</span>
          <hr class="flex-grow border-gray-300 dark:border-gray-600">
        </div>

        <a href="{{ url_for('auth.login_google') }}"
          class="w-full flex items-center justify-center mb-2 border border-gray-300 rounded-lg hover:bg-gray-100 text-gray-700 px-5 py-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:bg-gray-600">
          <img src="https://www.svgrepo.com/show/355037/google.svg" class="w-5 h-5 mr-2" alt="Google logo">
          Sign In with Google
        </a>

        <p class="text-gray-500 dark:text-gray-400 mb-6">
          New here? <a href="/auth/register" class="text-blue-600">Create an account.</a>
        </p>
      </form>
    </div>

    <div class="hidden md:flex w-1/2 bg-primary-50 dark:bg-primary-900 items-center justify-center p-8">
      <img src="{{ url_for('static', filename='assets/illustration.svg') }}" alt="Illustration"
        class="w-full h-full object-contain">
    </div>
  </div>

  <script>
    window.addEventListener("load", () => lucide.createIcons());
  </script>
  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const urlParams = new URLSearchParams(window.location.search);
      const errorMessage = urlParams.get("error");
      if (errorMessage) {
        showAlert("Error", errorMessage, "error");
      }
    });
  </script>
</body>

</html>